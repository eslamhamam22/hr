<div class="dashboard-container">
  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading-state">
    <div class="spinner"></div>
    <p>Loading dashboard...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage()" class="alert alert-error">
    {{ errorMessage() }}
    <button class="btn btn-secondary" (click)="loadDashboard()">Retry</button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!isLoading() && !errorMessage() && dashboard()" class="dashboard-content">
    
    <!-- Welcome Header -->
    <div class="welcome-header">
      <div class="welcome-text">
        <h1>Welcome back, {{ dashboard()?.employeeName }} üëã</h1>
        <p class="subtitle">{{ dashboard()?.role }} ‚Ä¢ {{ dashboard()?.departmentName }}</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary" (click)="navigateTo('requests/new')">
          ‚ûï New Request
        </button>
      </div>
    </div>

    <!-- ADMIN DASHBOARD -->
    <div *ngIf="adminDashboard() as admin" class="admin-dashboard fade-in">
        
        <!-- System Stats Cards -->
        <div class="summary-grid">
            <div class="summary-card stat-card">
                <div class="card-header"><span class="card-icon">üë•</span><h3>Employees</h3></div>
                <div class="card-content main-stat">{{ admin.totalEmployees }}</div>
            </div>
            <div class="summary-card stat-card">
                <div class="card-header"><span class="card-icon">üè¢</span><h3>Departments</h3></div>
                <div class="card-content main-stat">{{ admin.totalDepartments }}</div>
            </div>
            <div class="summary-card stat-card">
                <div class="card-header"><span class="card-icon">üìÖ</span><h3>Leave Requests</h3></div>
                <div class="card-content">
                    <div class="main-stat">{{ admin.systemLeaveStats.total }}</div>
                    <div class="mini-stat-row">
                        <span class="badge pending">{{ admin.systemLeaveStats.pending }} Pending</span>
                    </div>
                </div>
            </div>
            <div class="summary-card stat-card">
                <div class="card-header"><span class="card-icon">‚è∞</span><h3>Overtime Requests</h3></div>
                <div class="card-content">
                    <div class="main-stat">{{ admin.systemOvertimeStats.total }}</div>
                    <div class="mini-stat-row">
                        <span class="badge pending">{{ admin.systemOvertimeStats.pending }} Pending</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Charts -->
        <div class="charts-grid">
            <div class="chart-card large">
                <h3>System Request Trend</h3>
                <div class="chart-wrapper">
                    <canvas id="sysTrendChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>Requests by Department</h3>
                <div class="chart-wrapper">
                    <canvas id="deptChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>Leave Type Distribution</h3>
                <div class="chart-wrapper">
                    <canvas id="distChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- MANAGER DASHBOARD (Team View) -->
    <div *ngIf="managerDashboard() as manager" class="manager-dashboard fade-in">
        <h2 class="section-title">Team Overview</h2>
        
        <div class="summary-grid">
            <div class="summary-card approvals-card">
                <div class="card-header">
                  <span class="card-icon">üìã</span>
                  <h3>Pending Approvals</h3>
                </div>
                <div class="card-content">
                  <div class="main-stat">
                    <span class="stat-value highlight">{{ manager.pendingApprovalsCount }}</span>
                    <span class="stat-label">Awaiting Review</span>
                  </div>
                  <button class="btn btn-primary btn-block" (click)="navigateTo('approvals')">
                    Review Requests
                  </button>
                </div>
            </div>
            
            <!-- Team Summary Cards Loop -->
            <div class="team-summary-list">
                 <h3>Team Members</h3>
                 <div class="team-list-scroll">
                     <div class="team-member-item" *ngFor="let member of manager.teamSummary">
                        <div class="member-avatar">{{ member.userName.charAt(0) }}</div>
                        <div class="member-details">
                            <span class="name">{{ member.userName }}</span>
                            <span class="stats">Leaves: {{ member.leaveDays }}d | OT: {{ member.overtimeHours }}h</span>
                        </div>
                        <span class="badge warning" *ngIf="member.pendingRequests > 0">{{ member.pendingRequests }} Pending</span>
                     </div>
                 </div>
            </div>
        </div>

        <!-- Manager Charts -->
        <div class="charts-grid">
            <div class="chart-card large">
                <h3>Team Request Activity</h3>
                <div class="chart-wrapper">
                    <canvas id="teamTrendChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>Team Leave Distribution</h3>
                <div class="chart-wrapper">
                    <canvas id="teamTypeChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- EMPLOYEE DASHBOARD (Personal View) -->
    <!-- Always shown for everyone as 'My Summary' -->
    <div class="employee-dashboard section fade-in">
        <h2 class="section-title">My Summary</h2>
        
        <div class="summary-grid">
          <!-- Leave Summary Card -->
          <div class="summary-card leave-card">
            <div class="card-header">
              <span class="card-icon">üìÖ</span>
              <h3>Leave Balance</h3>
            </div>
            <div class="card-content">
              <div class="main-stat">
                <span class="stat-value">{{ dashboard()?.leaveSummary?.totalDaysRemaining }}</span>
                <span class="stat-label">Days Remaining</span>
              </div>
              <div class="stat-row">
                <div class="mini-stat">
                  <span class="value">{{ dashboard()?.leaveSummary?.totalDaysUsed }}</span>
                  <span class="label">Used</span>
                </div>
                <div class="mini-stat">
                  <span class="value">{{ dashboard()?.leaveSummary?.pendingRequests }}</span>
                  <span class="label">Pending</span>
                </div>
              </div>
            </div>
          </div>
    
          <!-- Overtime Summary Card -->
          <div class="summary-card overtime-card">
            <div class="card-header">
              <span class="card-icon">‚è∞</span>
              <h3>Overtime</h3>
            </div>
            <div class="card-content">
              <div class="main-stat">
                <span class="stat-value">{{ dashboard()?.overtimeSummary?.totalHours || 0 }}</span>
                <span class="stat-label">Hours Approved</span>
              </div>
              <div class="stat-row">
                <div class="mini-stat">
                  <span class="value">{{ dashboard()?.overtimeSummary?.totalRequests }}</span>
                  <span class="label">Total</span>
                </div>
                <div class="mini-stat">
                  <span class="value">{{ dashboard()?.overtimeSummary?.pendingRequests }}</span>
                  <span class="label">Pending</span>
                </div>
              </div>
            </div>
          </div>
        </div>
    
        <!-- Recent Requests -->
        <div class="section">
          <div class="section-header">
            <h3>Recent Requests</h3>
            <button class="btn btn-link" (click)="navigateTo('requests/list')">View All ‚Üí</button>
          </div>
    
          <div class="recent-requests-list" *ngIf="dashboard()?.recentRequests?.length; else noRequests">
            <div class="request-item" *ngFor="let request of dashboard()?.recentRequests">
              <div class="request-icon" [class]="request.requestType.includes('Overtime') ? 'overtime' : 'leave'">
                {{ request.requestType.includes('Overtime') ? '‚è∞' : 'üìÖ' }}
              </div>
              <div class="request-info">
                <div class="request-type">{{ request.requestType }}</div>
                <div class="request-dates">
                  {{ formatDate(request.startDate) }} - {{ formatDate(request.endDate) }}
                  <span *ngIf="request.days"> ‚Ä¢ {{ request.days }} days</span>
                  <span *ngIf="request.hours"> ‚Ä¢ {{ request.hours }} hrs</span>
                </div>
              </div>
              <div class="request-status">
                <span class="status-badge" [class]="getStatusClass(request.status)">
                  {{ request.status }}
                </span>
              </div>
            </div>
          </div>
    
          <ng-template #noRequests>
            <div class="empty-state">
              <span class="empty-icon">üì≠</span>
              <p>No recent requests</p>
              <button class="btn btn-primary" (click)="navigateTo('requests/new')">Create Your First Request</button>
            </div>
          </ng-template>
        </div>
    </div>
  </div>
</div>